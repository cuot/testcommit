string vQuery = "";
vQuery += " DECLARE @DYNAMIC_COLUMNS1 NVARCHAR(MAX) = '';DECLARE @DYNAMIC_COLUMNS2 NVARCHAR(MAX) = '';DECLARE @EXEC_QUERY VARCHAR(MAX) = ''; ";
vQuery += " SELECT @DYNAMIC_COLUMNS1 = CONCAT(@DYNAMIC_COLUMNS1,'[', name ,']',',')";
vQuery += " FROM ( select i.name from r_resumekr r  ";
vQuery += " inner join m_jobinfo j on j.id=r.jobid  ";
vQuery += " inner join M_Evaluation_interview m on m.ResumeID = r.ID  ";
//vQuery += " inner join M_IntervieweeBelong EB on r.ID = EB.ResumeID ";
vQuery += " inner join M_InterviewerBelong RB on RB.GroupID = m.GroupID ";
vQuery += " left outer join[sos].[dbo].[InterviewerInfo] i on i.ID = RB.InterviewerID";
vQuery += " Where r.SiteID = " + g_SiteID + " and r.FinalConfirm = 1  and r.ID = " + vID + "  AND i.name IS NOT NULL  GROUP BY i.name, i.ID ) A";
vQuery += " SELECT @DYNAMIC_COLUMNS2 = CONCAT(@DYNAMIC_COLUMNS2,'ISNULL([', name ,'], ''미평가'') AS [', name ,'] ',',')";
vQuery += " FROM ( select i.name from r_resumekr r  ";
vQuery += " inner join m_jobinfo j on j.id=r.jobid  ";
vQuery += " inner join M_Evaluation_interview m on m.ResumeID = r.ID  ";
vQuery += " inner join M_InterviewerBelong RB on RB.GroupID = m.GroupID  ";
vQuery += " left outer join[sos].[dbo].[InterviewerInfo] i on i.ID = RB.InterviewerID";
vQuery += " Where r.SiteID = " + g_SiteID + " and r.FinalConfirm = 1  and r.ID = " + vID + "  AND i.name IS NOT NULL  GROUP BY i.name, i.ID ) A";
vQuery += " SET @DYNAMIC_COLUMNS1 = CASE WHEN LEN(@DYNAMIC_COLUMNS1)=0 THEN '' ELSE LEFT(@DYNAMIC_COLUMNS1, LEN(@DYNAMIC_COLUMNS1)-1) END";
vQuery += " SET @DYNAMIC_COLUMNS2 = CASE WHEN LEN(@DYNAMIC_COLUMNS2)=0 THEN '' ELSE LEFT(@DYNAMIC_COLUMNS2, LEN(@DYNAMIC_COLUMNS2)-1) END ";
vQuery += " IF(@DYNAMIC_COLUMNS1 <> '') BEGIN SET @EXEC_QUERY = ' SELECT * "; 
//vQuery += "       Resumeid";
//vQuery += "     , Title";
//vQuery += "     , content";
//vQuery += "     , contentS";
//vQuery += "     , interviewername";
//vQuery += "     , interviewerid";
//vQuery += "     , EvalID";
//vQuery += "     , DetailID";
//vQuery += "     , AnswerType";
//vQuery += "     , RegID";
vQuery += "  FROM ( select r.id AS Resumeid,i.name,e.Title,replace(edm.Content,''<br>'',''<br style=\"mso-data-placement:same-cell;\">'') as content,replace(eds.Content,''<br>'',''<br style=\"mso-data-placement:same-cell;\">'') as contentS,isnull(i.name,'''') as interviewername,isnull(i.ID,0) as interviewerid,e.ID AS EvalID ,isnull(ei.ID,0) AS DetailID,edm.AnswerType,case when ei.eval_type=''A'' then isnull(cast(ei.answer as varchar(1000)),''미평가'') else isnull(cast(ei.answer_text as varchar(1000)),''미평가'') end as score, isnull(ei.RegID,'''') AS RegID";
vQuery += " from r_resumekr r  ";
vQuery += " inner join m_jobinfo j on j.id=r.jobid  ";
vQuery += " inner join m_recruitfield f on f.id=r.applypart1 ";
//vQuery += " inner join M_IntervieweeBelong EB on r.ID = EB.ResumeID ";
vQuery += " inner join m_levelgroup lg on lg.JobID = j.ID ";
vQuery += " INNER JOIN M_IntervieweeBelong EB ON EB.ResumeID = r.ID AND EB.GroupID = lg.ID ";
vQuery += " INNER JOIN M_InterviewerBelong RB ON RB.GroupID = EB.GroupID ";
vQuery += " inner join[sos].[dbo].[InterviewerInfo] i on i.ID = RB.InterviewerID ";
vQuery += " inner join M_Evaluation e on lg.EvalID = e.id ";
vQuery += " inner join M_Evaluation_Detail edm on edm.EvaluationID=e.ID and edm.MainSub=''M''  ";
vQuery += " inner join M_Evaluation_Detail eds on eds.mainid=edm.id and eds.MainSub=''S''  ";
vQuery += " left outer join M_Evaluation_interview ei on ei.Eval_Detail_ID=eds.ID and ei.resumeid=r.id and ei.regid=i.UserID and ei.eval_type<>''B'' ";
vQuery += " Where r.SiteID = " + g_SiteID + " and e.EvaluationType=1  and r.FinalConfirm = 1 and r.ID = " + vID;
vQuery += " ) RESULT ";
vQuery += " PIVOT ( max(score) FOR name IN ('+@DYNAMIC_COLUMNS1+') ) AS PIVOT_RESULT";
vQuery += " ORDER BY interviewerid, EvalID, DetailID, AnswerType' ";
vQuery += " EXEC(@EXEC_QUERY) END";
#endregion
DataTable dt = new DataTable();
DataTable dtCopy = new DataTable();
dt = clsA.admin_ResumeKrResumeEvaluateInfo_Select(SiteCode(), vQuery);